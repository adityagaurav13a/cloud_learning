{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Contact — Modern Form</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --ink:   #0d0d0d;
      --cream: #f5f0e8;
      --rust:  #c0392b;
      --gold:  #d4a853;
      --mist:  #e8e2d7;
      --white: #ffffff;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'DM Sans', sans-serif;
      background-color: var(--cream);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow-x: hidden;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: linear-gradient(135deg, var(--ink) 0%, var(--ink) 42%, var(--cream) 42%);
      z-index: 0;
    }

    body::after {
      content: '';
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 0;
    }

    .page-wrap {
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 960px;
      padding: 2rem 1.5rem;
    }

    .card-shell {
      display: grid;
      grid-template-columns: 1fr 1.6fr;
      min-height: 600px;
      border-radius: 4px;
      overflow: hidden;
      box-shadow: 0 40px 100px rgba(0,0,0,.35);
      animation: riseIn .8s cubic-bezier(.22,1,.36,1) both;
    }

    @keyframes riseIn {
      from { opacity: 0; transform: translateY(40px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* ── LEFT PANEL ──────────────────────────── */
    .left-panel {
      background: var(--rust);
      padding: 3rem 2.5rem;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      position: relative;
      overflow: hidden;
    }

    .left-panel::before {
      content: '';
      position: absolute;
      width: 260px; height: 260px;
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 50%;
      bottom: -80px; right: -80px;
    }
    .left-panel::after {
      content: '';
      position: absolute;
      width: 160px; height: 160px;
      border: 1px solid rgba(255,255,255,.1);
      border-radius: 50%;
      top: -40px; right: 20px;
    }

    .label-tag {
      font-size: .7rem;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: rgba(255,255,255,.55);
      font-weight: 500;
    }

    .panel-heading {
      font-family: 'Playfair Display', serif;
      font-size: clamp(2rem, 4vw, 2.8rem);
      color: #fff;
      line-height: 1.15;
      margin: 1.2rem 0 1rem;
    }

    .panel-sub {
      font-size: .9rem;
      color: rgba(255,255,255,.65);
      line-height: 1.7;
      font-weight: 300;
    }

    .divider-line {
      width: 40px; height: 2px;
      background: var(--gold);
      margin: 2.5rem 0 1.5rem;
    }

    .contact-info { display: flex; flex-direction: column; gap: 1rem; }

    .info-item {
      display: flex;
      align-items: center;
      gap: .75rem;
      color: rgba(255,255,255,.75);
      font-size: .85rem;
    }

    .info-icon {
      width: 32px; height: 32px;
      background: rgba(255,255,255,.1);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: .8rem; flex-shrink: 0;
    }

    /* ── RIGHT PANEL ─────────────────────────── */
    .right-panel {
      background: var(--white);
      padding: 3rem 2.8rem;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .form-title {
      font-family: 'Playfair Display', serif;
      font-size: 1.5rem;
      color: var(--ink);
      margin-bottom: .35rem;
    }

    .form-sub {
      font-size: .82rem;
      color: #888;
      margin-bottom: 2.2rem;
      font-weight: 300;
    }

    /* ── CUSTOM INPUTS ───────────────────────── */
    .field-wrap {
      position: relative;
      margin-bottom: 1.4rem;
      animation: fadeUp .5s ease both;
    }

    .field-wrap:nth-child(1) { animation-delay: .1s; }
    .field-wrap:nth-child(2) { animation-delay: .18s; }
    .field-wrap:nth-child(3) { animation-delay: .26s; }
    .field-wrap:nth-child(4) { animation-delay: .34s; }
    .field-wrap:nth-child(5) { animation-delay: .42s; }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(14px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .field-label {
      font-size: .7rem;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: #999;
      font-weight: 500;
      display: block;
      margin-bottom: .45rem;
      transition: color .2s;
    }

    .field-wrap:focus-within .field-label { color: var(--rust); }

    .field-input {
      width: 100%;
      border: none;
      border-bottom: 1.5px solid var(--mist);
      border-radius: 0;
      padding: .55rem 0 .55rem .05rem;
      font-family: 'DM Sans', sans-serif;
      font-size: .92rem;
      color: var(--ink);
      background: transparent;
      outline: none;
      transition: border-color .25s;
    }

    .field-input:focus { border-color: var(--rust); }
    .field-input::placeholder { color: #ccc; font-weight: 300; }

    textarea.field-input {
      resize: none;
      min-height: 90px;
    }

    select.field-input {
      appearance: none;
      cursor: pointer;
      background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23bbb' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 4px center;
      padding-right: 1.5rem;
    }

    .field-line {
      display: block;
      width: 0; height: 1.5px;
      background: var(--rust);
      transition: width .3s ease;
      margin-top: -1.5px;
    }
    .field-wrap:focus-within .field-line { width: 100%; }

    .row-fields {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0 1.5rem;
    }

    /* Checkbox */
    .check-row {
      display: flex;
      align-items: flex-start;
      gap: .6rem;
      margin-bottom: 1.8rem;
    }

    .check-row input[type="checkbox"] {
      accent-color: var(--rust);
      width: 15px; height: 15px;
      margin-top: 2px;
      cursor: pointer;
    }

    .check-label {
      font-size: .78rem;
      color: #888;
      line-height: 1.5;
    }

    .check-label a { color: var(--rust); text-decoration: none; }
    .check-label a:hover { text-decoration: underline; }

    /* Submit Button */
    .btn-send {
      background: var(--ink);
      color: #fff;
      border: none;
      padding: .85rem 2.2rem;
      font-family: 'DM Sans', sans-serif;
      font-size: .82rem;
      letter-spacing: .14em;
      text-transform: uppercase;
      font-weight: 500;
      border-radius: 2px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: background .3s, transform .15s;
    }

    .btn-send::after {
      content: '';
      position: absolute;
      inset: 0;
      background: var(--rust);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform .35s ease;
      z-index: 0;
    }

    .btn-send:hover::after { transform: scaleX(1); }
    .btn-send:active { transform: scale(.97); }
    .btn-send span { position: relative; z-index: 1; }

    /* Success state */
    .success-msg {
      display: none;
      text-align: center;
      padding: 2rem 0;
      animation: fadeUp .5s ease both;
    }

    .success-icon {
      width: 56px; height: 56px;
      border-radius: 50%;
      background: #f0f9f0;
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 1rem;
      font-size: 1.5rem;
      color: #27ae60;
    }

    .success-msg h3 {
      font-family: 'Playfair Display', serif;
      font-size: 1.4rem;
      color: var(--ink);
      margin-bottom: .4rem;
    }

    .success-msg p { font-size: .85rem; color: #888; font-weight: 300; }

    /* Validation */
    .field-input.error { border-color: #e74c3c !important; }
    .err-msg { font-size: .72rem; color: #e74c3c; margin-top: .3rem; display: none; }
    .err-msg.show { display: block; }

    /* Network / server error banner */
    .server-error {
      display: none;
      background: #fdf2f2;
      border-left: 3px solid #e74c3c;
      color: #c0392b;
      font-size: .8rem;
      padding: .65rem 1rem;
      border-radius: 2px;
      margin-bottom: 1.2rem;
    }
    .server-error.show { display: block; }

    @media (max-width: 700px) {
      .card-shell { grid-template-columns: 1fr; }
      .left-panel { padding: 2rem 1.8rem; min-height: unset; }
      .right-panel { padding: 2rem 1.8rem; }
      .row-fields { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<div class="page-wrap">
  <div class="card-shell">

    <!-- LEFT PANEL -->
    <div class="left-panel">
      <div>
        <span class="label-tag">Get in Touch</span>
        <h1 class="panel-heading">Let's start something great.</h1>
        <p class="panel-sub">Have a project in mind or just want to say hello? Fill in the form and we'll get back to you within 24 hours.</p>
      </div>
      <div>
        <div class="divider-line"></div>
        <div class="contact-info">
          <div class="info-item">
            <div class="info-icon">✉</div>
            <span>adityagaurav13a@gmail.com</span>
          </div>
          <div class="info-item">
            <div class="info-icon">☎</div>
            <span>+91 8052476662</span>
          </div>
          <div class="info-item">
            <div class="info-icon">⌖</div>
            <span>Lucknow, UP 226017</span>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT PANEL -->
    <div class="right-panel">
      <h2 class="form-title">Send a message</h2>
      <p class="form-sub">All fields marked with * are required.</p>

      <!-- Server error banner -->
      <div class="server-error" id="serverError"></div>

      <form id="contactForm" novalidate>
        {% csrf_token %}

        <div class="row-fields">
          <div class="field-wrap">
            <label class="field-label" for="firstName">First Name *</label>
            <input class="field-input" type="text" id="firstName" name="firstName" placeholder="Aditya" required/>
            <span class="field-line"></span>
            <span class="err-msg" id="err-firstName">Please enter your first name.</span>
          </div>
          <div class="field-wrap">
            <label class="field-label" for="lastName">Last Name *</label>
            <input class="field-input" type="text" id="lastName" name="lastName" placeholder="Gaurav" required/>
            <span class="field-line"></span>
            <span class="err-msg" id="err-lastName">Please enter your last name.</span>
          </div>
        </div>

        <div class="field-wrap">
          <label class="field-label" for="email">Email Address *</label>
          <input class="field-input" type="email" id="email" name="email" placeholder="aditya@example.com" required/>
          <span class="field-line"></span>
          <span class="err-msg" id="err-email">Please enter a valid email address.</span>
        </div>

        <div class="field-wrap">
          <label class="field-label" for="subject">I'm interested in *</label>
          <select class="field-input" id="subject" name="subject" required>
            <option value="">— Select a topic —</option>
            <option>Web Design</option>
            <option>Branding</option>
            <option>Development</option>
            <option>Consulting</option>
            <option>Other</option>
          </select>
          <span class="field-line"></span>
          <span class="err-msg" id="err-subject">Please select a topic.</span>
        </div>

        <div class="field-wrap">
          <label class="field-label" for="message">Your Message *</label>
          <textarea class="field-input" id="message" name="message" placeholder="Tell us about your project…" required></textarea>
          <span class="field-line"></span>
          <span class="err-msg" id="err-message">Please write a short message (min 10 characters).</span>
        </div>

        <div class="check-row">
          <input type="checkbox" id="agree" name="agree" required/>
          <label class="check-label" for="agree">
            I agree to the <a href="#">Privacy Policy</a> and consent to being contacted regarding my inquiry.
          </label>
        </div>

        <button type="submit" class="btn-send"><span>Send Message →</span></button>
      </form>

      <div class="success-msg" id="successMsg">
        <div class="success-icon">✓</div>
        <h3>Message Received!</h3>
        <p>Thanks for reaching out. We'll be in touch within 24 hours.</p>
      </div>
    </div>

  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
<script>
  // ── Grab the CSRF token Django injected into the form ─────────────────────
  const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

  const form       = document.getElementById('contactForm');
  const successMsg = document.getElementById('successMsg');
  const serverErr  = document.getElementById('serverError');

  // ── Client-side validation rules ─────────────────────────────────────────
  const rules = {
    firstName: v => v.trim().length > 0,
    lastName:  v => v.trim().length > 0,
    email:     v => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v.trim()),
    subject:   v => v !== '',
    message:   v => v.trim().length >= 10,
  };

  function showError(id, msg) {
    const el  = document.getElementById(id);
    const err = document.getElementById('err-' + id);
    el.classList.add('error');
    if (msg) err.textContent = msg;
    err.classList.add('show');
  }

  function clearError(id) {
    document.getElementById(id).classList.remove('error');
    document.getElementById('err-' + id).classList.remove('show');
  }

  function validate(id) {
    const ok = rules[id](document.getElementById(id).value);
    ok ? clearError(id) : showError(id, null);
    return ok;
  }

  // Live validation on blur / fix-on-type
  Object.keys(rules).forEach(id => {
    const el = document.getElementById(id);
    el.addEventListener('blur',  () => validate(id));
    el.addEventListener('input', () => { if (el.classList.contains('error')) validate(id); });
  });

  // ── Submit → POST JSON to Django view ────────────────────────────────────
  form.addEventListener('submit', async e => {
    e.preventDefault();
    serverErr.classList.remove('show');

    const agree = document.getElementById('agree');
    const allOk = Object.keys(rules).map(id => validate(id)).every(Boolean) && agree.checked;
    if (!allOk) return;

    const btn = form.querySelector('.btn-send');
    btn.disabled = true;
    btn.querySelector('span').textContent = 'Sending…';

    try {
      const res = await fetch(window.location.pathname, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken':  csrfToken,          // Django CSRF header
        },
        body: JSON.stringify({
          firstName: document.getElementById('firstName').value,
          lastName:  document.getElementById('lastName').value,
          email:     document.getElementById('email').value,
          subject:   document.getElementById('subject').value,
          message:   document.getElementById('message').value,
        }),
      });

      const data = await res.json();

      if (data.ok) {
        form.style.display       = 'none';
        successMsg.style.display = 'block';
      } else {
        // Map server-side errors back to individual fields
        if (data.errors) {
          Object.entries(data.errors).forEach(([key, msg]) => {
            if (rules[key]) showError(key, msg);
          });
          if (data.errors.__all__) {
            serverErr.textContent = data.errors.__all__;
            serverErr.classList.add('show');
          }
        }
        btn.disabled = false;
        btn.querySelector('span').textContent = 'Send Message →';
      }

    } catch (err) {
      serverErr.textContent = 'Network error — please try again.';
      serverErr.classList.add('show');
      btn.disabled = false;
      btn.querySelector('span').textContent = 'Send Message →';
      console.error(err);
    }
  });
</script>
</body>
</html>
